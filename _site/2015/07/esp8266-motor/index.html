<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Wifi Controlled Motors using ESP8266 and ATtiny85 &middot; nyl.io
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/blog/public/css/poole.css">
  <link rel="stylesheet" href="/blog/public/css/syntax.css">
  <link rel="stylesheet" href="/blog/public/css/lanyon.css">


  <link rel="stylesheet" href="/blog/public/css/nyl.css">
  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/blog/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Fonts -->

  <link href='https://fonts.googleapis.com/css?family=Lato:400,300,100,700,900' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
</head>


  <body class="theme-base-08 layout-reverse">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/blog">Home</a>

    

    
    
      
        
      
    
      
        
          
            <a class="sidebar-nav-item" href="/blog/about.html">About</a>
          
        
      
    
      
    
      
        
      
    
      
        
          
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
        
          
            <a class="sidebar-nav-item" href="/blog/test.html">Test</a>
          
        
      
    

<!--     <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span> -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h2 class="masthead-title">
            <a href="/blog/" title="Home">nyl.io</a>
            <small>Random neural firings by Nancy Yi Liang.</small>
          </h2>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Wifi Controlled Motors using ESP8266 and ATtiny85</h1>
  <span class="post-date">23 Jul 2015</span>
  <p>Picking up where <a href="http://blog.nyl.io/esp8266-led-arduino/">we left off</a>, I’m still on my way to create the cheap wifi connected, internet controlled motor. I think I found my perfect combination of awesome.</p>

<div class="for-mobile">
Click on the diagram below to go through the workflow. It will open up a new page. Once you are on the new page, click on the RIGHT SIDE of the screen to go forward, and click on the LEFT SIDE of the screen to go back. 
<a target="_blank" href="http://nyl.io/impress/espmotor.html?mobile=on"><img src="http://nyl.io/impress/espmotor.png" /></a>
</div>

<div class="not-for-mobile">
Click on the diagram below to go through the workflow.</div>
<div class="not-for-mobile" style="position:relative; padding-bottom: 75%; padding-top: 25px; ">
<iframe frameborder="0" src="http://nyl.io/impress/espmotor.html" style="position: absolute; top:0; left:0; width: 100%; height: 100%"></iframe></div>

<p style="color: #A00; font-weight: bold; background: #FEE; border-radius: 5px; border: solid 5px #A00; padding: 10px; box-sizing: border-box;">
PLEASE NOTE: The ESP8266, index.php, and light.json part was covered <a href="http://blog.nyl.io/esp8266-led-arduino/">the previous tutorial</a>, which goes over how to program an ESP8266 with Arduino IDE, and hook it up to the internet. It also explains how the ESP8266 should ping light.json, and how index.php sends info to light.json. Again: <a href="http://blog.nyl.io/esp8266-led-arduino/">here's the link to the previous tutorial</a>!</p>

<p>And as always, you can find the code, diagrams, and all sorts of goodies on this project’s <a href="https://github.com/neuralfirings/esp8266led">GitHub Page</a>.</p>

<h2 id="gather-ye-ingredients">Gather Ye, Ingredients</h2>

<p><strong>Main Components:</strong></p>

<ol>
  <li><a href="http://amzn.to/1Lu6QHu">ESP8266-01 Wifi Chip</a></li>
  <li><a href="http://amzn.to/1fhk38N">Arduino Uno</a> for flashing the ATtiny85</li>
  <li><a href="http://amzn.to/1gJgsRW">ATTiny85</a></li>
  <li><a href="http://amzn.to/1CKtcSm">L293D Motor Driver</a></li>
  <li><a href="http://amzn.to/1HDGT4d">5VDC Stepper Motor</a></li>
</ol>

<p><strong>General Electronics</strong></p>

<ol>
  <li><a href="http://amzn.to/1gJg9Xs">10uF Capacitor</a> (link is to a bunch of assorted capacitors)</li>
  <li><a href="http://amzn.to/1Otn0iU">LED</a> This link comes with assorted LEDs and a pack of resistors to boot. For this project, use a purple or white light (closest to 3.3V). Or you know. Use resistors. You can also use <a href="http://www.digikey.com/product-detail/en/0/754-1891-ND">LEDs with built in resistors</a> to be safe.</li>
  <li><a href="https://octopart.com/ld1117v33-stmicroelectronics-526800">3.3V Regulator</a></li>
  <li><a href="http://amzn.to/1HDGY7Z">5V Regulator</a></li>
  <li><a href="http://amzn.to/1HDHrqO">9V Battery</a></li>
  <li><a href="http://amzn.to/1MjBPq1">9V Battery Connector</a></li>
</ol>

<h2 id="step-1-prep-the-arduino-uno-as-an-isp">Step 1: Prep the Arduino Uno as an ISP</h2>

<p>Before, I had whipped up this whole system with an Arduino controlling the motor instead of an ATtiny85 chip. I learned that you can actually flash some Arduino programs on the ATtiny85 chip, which is AWESOME. The ATtiny85 chip (the thing I’m holding here) is smaller and cheaper than the Arduino.</p>

<p><img src="http://blog.nyl.io/content/images/2015/07/arduino_vs_attiny.jpg" alt="" /></p>

<p>So adorbs, right?</p>

<p>Prepping the Arduino:</p>

<ol>
  <li><a href="https://www.arduino.cc/en/main/software">Download the Arduino IDE</a> if you haven’t already</li>
  <li>Hook up the Arduino Uno to your computer using a printer cable</li>
  <li>Open up the ArduinoISP sketch (File &gt; Examples &gt; ArduinoISP) <img src="http://blog.nyl.io/content/images/2015/07/arduinoisp.jpg" alt="" /></li>
  <li>Click “Upload” button (the right arrow above the code area) <img src="http://blog.nyl.io/content/images/2015/07/arduinoupload.jpg" alt="" /></li>
</ol>

<p>Then <strong>BAM</strong>! Your Arduino is now ready to program Atmel Chips!</p>

<h2 id="step-2-add-attiny85-to-arduino-ide">Step 2: Add ATtiny85 to Arduino IDE</h2>

<p>Now we’re going to add ATtiny85 to the list of available boards. This way, you can use Arduino language to program ATtiny85.</p>

<ol>
  <li>
    <p>Go to: Arduino &gt; Preferences <img src="http://blog.nyl.io/content/images/2015/07/arduino_pref.jpg" alt="" /></p>
  </li>
  <li>
    <p>Add this to Additional Board Manager URLs at the bottom and click “OK” when done: https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json <img src="http://blog.nyl.io/content/images/2015/07/arduino_boardmanagerurl.jpg" alt="" /></p>
  </li>
  <li>
    <p>Go to: Tools &gt; Board &gt; Board Manager <img src="http://blog.nyl.io/content/images/2015/07/arduino_boardmanager.jpg" alt="" /></p>
  </li>
  <li>
    <p>Search for “attiny,” click on it, then click “install” <img src="http://blog.nyl.io/content/images/2015/07/arduino_installattiny.jpg" alt="" /></p>
  </li>
  <li>
    <p>Restart Arduino</p>
  </li>
  <li>
    <p>Go to: Tools &gt; Board &gt; ATtiny <img src="http://blog.nyl.io/content/images/2015/07/arduino_attiny.jpg" alt="" /></p>
  </li>
</ol>

<h2 id="step-3-wire-it-up">Step 3: Wire it Up</h2>
<p>Wire everything up like so. The Arduino IDE will send the code directly to ATtiny85. Please note the 10uF capacitor. This prevents the Arduino from resetting and starting up bootloader mode.</p>

<p><img src="http://blog.nyl.io/content/images/2015/07/arduino_attiny_bb.png" alt="" />
<small>(image source: <a href="http://highlowtech.org/?p=1706">High Low Tech Blog</a>)</small></p>

<p>Here is the pin labels for the ATtiny85 (and ATtiny45)
<img src="/content/images/2015/08/attiny_pinout.png" alt="" /></p>

<h2 id="step-4-code-for-the-attiny85">Step 4: Code for the ATtiny85</h2>

<p>I based this off of <a href="https://learn.adafruit.com/adafruit-arduino-lesson-16-stepper-motors">Adafruit’s Arduino/Stepper Motor Tutorial</a>. I made a few tweaks to Adafruit’s code. You’ll see the changes in where I commented out the original values and why.</p>

<p>Go to: File &gt; New and copy/paste the following code:</p>

<p>```
/*
Adafruit Arduino - Lesson 16. Stepper
Modified to take input from ESP8266 instead of user
*/</p>

<h1 id="include-stepperh">include <stepper.h></stepper.h></h1>

<p>// NYL: changed the following 4 lines to match ATtiny85’s pin number
int in1Pin = 0; // was 12
int in2Pin = 1; // was 11
int in3Pin = 2; // was 10
int in4Pin = 3; // was 9
int readPin = 4; // NYL: new line, not in original Adafruit Tutorial</p>

<p>Stepper motor(512, in1Pin, in2Pin, in3Pin, in4Pin);</p>

<p>void setup()
{
  pinMode(in1Pin, OUTPUT);
  pinMode(in2Pin, OUTPUT);
  pinMode(in3Pin, OUTPUT);
  pinMode(in4Pin, OUTPUT);
  pinMode(readPin, INPUT);  // NYL: new line, listens for input on readPin</p>

<p>motor.setSpeed(20);
}</p>

<p>// NYL: changed this to read input from ESP, 
// then proceed at 32 steps every 1 second
void loop() 
{
  if (digitalRead(readPin)==1) {
    motor.step(32);
  }
  delay(1000);
}
```</p>

<p>File &gt; Save because you should always save your work!!</p>

<h2 id="step-5-flash-the-attiny85">Step 5: Flash the ATtiny85</h2>

<p>All righty! Your ISP (Arduino Uno) is ready. Your code is ready. Let’s flash some ICs! 🎉🎉🎉</p>

<p>Go to “Tools” and select the following settings:</p>

<p><img src="/content/images/2015/08/attiny_toolmenu.jpg" alt="" /></p>

<p>Just click “Upload” (the right arrow button).
<img src="http://blog.nyl.io/content/images/2015/07/arduino_upload2.jpg" alt="" /></p>

<p>There are some other tutorials on flashing the ATtiny85 you can look at if this doesn’t work:</p>

<ul>
  <li>High Low Tech Blog Posts (<a href="http://highlowtech.org/?p=1706">this one</a> and <a href="http://highlowtech.org/?p=1695">that one</a>) are great.</li>
  <li>There’s also <a href="https://www.hackster.io/arjun/programming-attiny85-with-arduino-uno">this post</a> on Hackster that is pretty good.</li>
</ul>

<h2 id="step-6-hook-everything-up">Step 6: Hook Everything Up</h2>

<p>Last I hooked everything up to get the motor running off of interwebs bits. I put some scotch tape on the motor so you can see it turning more easily.</p>

<iframe class="imgur-embed" width="100%" height="404" frameborder="0" src="http://i.imgur.com/mRuKtxu.gifv#embed"></iframe>

<p>Here’s a cleaned up drawing of the wiring:</p>

<p><img src="http://blog.nyl.io/content/images/2015/07/esp8266_attiny_noftdi_reg_9v_bb.png" alt="" /></p>

<p>In this diagram, the top breadboard power track represents 5V, and the bottom represents 3.3V. The basic logic follows the diagram at the beginning of this blog post. Rather than conceptual arrows, we have wires and breadboards.</p>

<p>Now, if you go to your <code>index.php</code> page, you can click the “Light On” and “Light Off” button. Only now, the light <em>and</em> the motor should turn on.</p>

<p>OOOOO… fancy.</p>

<h2 id="next-steps">Next Steps</h2>

<p>Just when you think you’ve shrunken everything, there’s a way to get things even smaller. For me, the next step is to make a Custom PCB of this and get rid of all the wires and breadboard.</p>

<p>After that, I might even start looking into getting the surface mount version of it working, so it’s even smaller (and cheaper). At this point, the battery and the motor will be the biggest pieces. So if you guys know of smaller 5V battery and motors, <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#032;&#095;&#064;&#110;&#121;&#108;&#046;&#105;&#111;">drop me a line!</a> ✉️</p>

<p>Ok. Now go make stuff.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="xrelated-posts">
    
      <li>
        <h5>
          <a href="/blog/2015/09/hello-world-intro">
            Hello World Projects
            <small>07 Sep 2015</small>
          </a>
        </h5>
      </li>
    
      <li>
        <h5>
          <a href="/blog/2015/09/welcome-to-jekyll">
            Welcome to Jekyll!
            <small>07 Sep 2015</small>
          </a>
        </h5>
      </li>
    
      <li>
        <h5>
          <a href="/blog/2015/09/hello-world-custom-pcb-fritzing">
            Hello World: Design PCBs with Fritzing
            <small>05 Sep 2015</small>
          </a>
        </h5>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
