<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      nyl.io &middot; In order to be old and wise, you must first be young and stupid.
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/blog/public/css/poole.css">
  <link rel="stylesheet" href="/blog/public/css/syntax.css">
  <link rel="stylesheet" href="/blog/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/blog/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-08 layout-reverse">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/blog/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/blog/about.html">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/blog/test.html">Test</a>
        
      
    

<!--     <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span> -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/blog" title="Home">nyl.io</a>
            <small>In order to be old and wise, you must first be young and stupid.</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog//2015/07/esp8266-motor">
        Wifi Controlled Motors using ESP8266 and ATtiny85
      </a>
    </h1>

    <span class="post-date">23 Jul 2015</span>

    <p>Picking up where <a href="http://blog.nyl.io/esp8266-led-arduino/">we left off</a>, I’m still on my way to create the cheap wifi connected, internet controlled motor. I think I found my perfect combination of awesome.</p>

<div class="for-mobile">
Click on the diagram below to go through the workflow. It will open up a new page. Once you are on the new page, click on the RIGHT SIDE of the screen to go forward, and click on the LEFT SIDE of the screen to go back. 
<a target="_blank" href="http://nyl.io/impress/espmotor.html?mobile=on"><img src="http://nyl.io/impress/espmotor.png" /></a>
</div>

<div class="not-for-mobile">
Click on the diagram below to go through the workflow.</div>
<div class="not-for-mobile" style="position:relative; padding-bottom: 75%; padding-top: 25px; ">
<iframe frameborder="0" src="http://nyl.io/impress/espmotor.html" style="position: absolute; top:0; left:0; width: 100%; height: 100%"></iframe></div>

<p style="color: #A00; font-weight: bold; background: #FEE; border-radius: 5px; border: solid 5px #A00; padding: 10px; box-sizing: border-box;">
PLEASE NOTE: The ESP8266, index.php, and light.json part was covered <a href="http://blog.nyl.io/esp8266-led-arduino/">the previous tutorial</a>, which goes over how to program an ESP8266 with Arduino IDE, and hook it up to the internet. It also explains how the ESP8266 should ping light.json, and how index.php sends info to light.json. Again: <a href="http://blog.nyl.io/esp8266-led-arduino/">here's the link to the previous tutorial</a>!</p>

<p>And as always, you can find the code, diagrams, and all sorts of goodies on this project’s <a href="https://github.com/neuralfirings/esp8266led">GitHub Page</a>.</p>

<h2 id="gather-ye-ingredients">Gather Ye, Ingredients</h2>

<p><strong>Main Components:</strong></p>

<ol>
  <li><a href="http://amzn.to/1Lu6QHu">ESP8266-01 Wifi Chip</a></li>
  <li><a href="http://amzn.to/1fhk38N">Arduino Uno</a> for flashing the ATtiny85</li>
  <li><a href="http://amzn.to/1gJgsRW">ATTiny85</a></li>
  <li><a href="http://amzn.to/1CKtcSm">L293D Motor Driver</a></li>
  <li><a href="http://amzn.to/1HDGT4d">5VDC Stepper Motor</a></li>
</ol>

<p><strong>General Electronics</strong></p>

<ol>
  <li><a href="http://amzn.to/1gJg9Xs">10uF Capacitor</a> (link is to a bunch of assorted capacitors)</li>
  <li><a href="http://amzn.to/1Otn0iU">LED</a> This link comes with assorted LEDs and a pack of resistors to boot. For this project, use a purple or white light (closest to 3.3V). Or you know. Use resistors. You can also use <a href="http://www.digikey.com/product-detail/en/0/754-1891-ND">LEDs with built in resistors</a> to be safe.</li>
  <li><a href="https://octopart.com/ld1117v33-stmicroelectronics-526800">3.3V Regulator</a></li>
  <li><a href="http://amzn.to/1HDGY7Z">5V Regulator</a></li>
  <li><a href="http://amzn.to/1HDHrqO">9V Battery</a></li>
  <li><a href="http://amzn.to/1MjBPq1">9V Battery Connector</a></li>
</ol>

<h2 id="step-1-prep-the-arduino-uno-as-an-isp">Step 1: Prep the Arduino Uno as an ISP</h2>

<p>Before, I had whipped up this whole system with an Arduino controlling the motor instead of an ATtiny85 chip. I learned that you can actually flash some Arduino programs on the ATtiny85 chip, which is AWESOME. The ATtiny85 chip (the thing I’m holding here) is smaller and cheaper than the Arduino.</p>

<p><img src="http://blog.nyl.io/content/images/2015/07/arduino_vs_attiny.jpg" alt="" /></p>

<p>So adorbs, right?</p>

<p>Prepping the Arduino:</p>

<ol>
  <li><a href="https://www.arduino.cc/en/main/software">Download the Arduino IDE</a> if you haven’t already</li>
  <li>Hook up the Arduino Uno to your computer using a printer cable</li>
  <li>Open up the ArduinoISP sketch (File &gt; Examples &gt; ArduinoISP) <img src="http://blog.nyl.io/content/images/2015/07/arduinoisp.jpg" alt="" /></li>
  <li>Click “Upload” button (the right arrow above the code area) <img src="http://blog.nyl.io/content/images/2015/07/arduinoupload.jpg" alt="" /></li>
</ol>

<p>Then <strong>BAM</strong>! Your Arduino is now ready to program Atmel Chips!</p>

<h2 id="step-2-add-attiny85-to-arduino-ide">Step 2: Add ATtiny85 to Arduino IDE</h2>

<p>Now we’re going to add ATtiny85 to the list of available boards. This way, you can use Arduino language to program ATtiny85.</p>

<ol>
  <li>
    <p>Go to: Arduino &gt; Preferences <img src="http://blog.nyl.io/content/images/2015/07/arduino_pref.jpg" alt="" /></p>
  </li>
  <li>
    <p>Add this to Additional Board Manager URLs at the bottom and click “OK” when done: https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json <img src="http://blog.nyl.io/content/images/2015/07/arduino_boardmanagerurl.jpg" alt="" /></p>
  </li>
  <li>
    <p>Go to: Tools &gt; Board &gt; Board Manager <img src="http://blog.nyl.io/content/images/2015/07/arduino_boardmanager.jpg" alt="" /></p>
  </li>
  <li>
    <p>Search for “attiny,” click on it, then click “install” <img src="http://blog.nyl.io/content/images/2015/07/arduino_installattiny.jpg" alt="" /></p>
  </li>
  <li>
    <p>Restart Arduino</p>
  </li>
  <li>
    <p>Go to: Tools &gt; Board &gt; ATtiny <img src="http://blog.nyl.io/content/images/2015/07/arduino_attiny.jpg" alt="" /></p>
  </li>
</ol>

<h2 id="step-3-wire-it-up">Step 3: Wire it Up</h2>
<p>Wire everything up like so. The Arduino IDE will send the code directly to ATtiny85. Please note the 10uF capacitor. This prevents the Arduino from resetting and starting up bootloader mode.</p>

<p><img src="http://blog.nyl.io/content/images/2015/07/arduino_attiny_bb.png" alt="" />
<small>(image source: <a href="http://highlowtech.org/?p=1706">High Low Tech Blog</a>)</small></p>

<p>Here is the pin labels for the ATtiny85 (and ATtiny45)
<img src="/content/images/2015/08/attiny_pinout.png" alt="" /></p>

<h2 id="step-4-code-for-the-attiny85">Step 4: Code for the ATtiny85</h2>

<p>I based this off of <a href="https://learn.adafruit.com/adafruit-arduino-lesson-16-stepper-motors">Adafruit’s Arduino/Stepper Motor Tutorial</a>. I made a few tweaks to Adafruit’s code. You’ll see the changes in where I commented out the original values and why.</p>

<p>Go to: File &gt; New and copy/paste the following code:</p>

<p>```
/*
Adafruit Arduino - Lesson 16. Stepper
Modified to take input from ESP8266 instead of user
*/</p>

<h1 id="include-stepperh">include <stepper.h></stepper.h></h1>

<p>// NYL: changed the following 4 lines to match ATtiny85’s pin number
int in1Pin = 0; // was 12
int in2Pin = 1; // was 11
int in3Pin = 2; // was 10
int in4Pin = 3; // was 9
int readPin = 4; // NYL: new line, not in original Adafruit Tutorial</p>

<p>Stepper motor(512, in1Pin, in2Pin, in3Pin, in4Pin);</p>

<p>void setup()
{
  pinMode(in1Pin, OUTPUT);
  pinMode(in2Pin, OUTPUT);
  pinMode(in3Pin, OUTPUT);
  pinMode(in4Pin, OUTPUT);
  pinMode(readPin, INPUT);  // NYL: new line, listens for input on readPin</p>

<p>motor.setSpeed(20);
}</p>

<p>// NYL: changed this to read input from ESP, 
// then proceed at 32 steps every 1 second
void loop() 
{
  if (digitalRead(readPin)==1) {
    motor.step(32);
  }
  delay(1000);
}
```</p>

<p>File &gt; Save because you should always save your work!!</p>

<h2 id="step-5-flash-the-attiny85">Step 5: Flash the ATtiny85</h2>

<p>All righty! Your ISP (Arduino Uno) is ready. Your code is ready. Let’s flash some ICs! 🎉🎉🎉</p>

<p>Go to “Tools” and select the following settings:</p>

<p><img src="/content/images/2015/08/attiny_toolmenu.jpg" alt="" /></p>

<p>Just click “Upload” (the right arrow button).
<img src="http://blog.nyl.io/content/images/2015/07/arduino_upload2.jpg" alt="" /></p>

<p>There are some other tutorials on flashing the ATtiny85 you can look at if this doesn’t work:</p>

<ul>
  <li>High Low Tech Blog Posts (<a href="http://highlowtech.org/?p=1706">this one</a> and <a href="http://highlowtech.org/?p=1695">that one</a>) are great.</li>
  <li>There’s also <a href="https://www.hackster.io/arjun/programming-attiny85-with-arduino-uno">this post</a> on Hackster that is pretty good.</li>
</ul>

<h2 id="step-6-hook-everything-up">Step 6: Hook Everything Up</h2>

<p>Last I hooked everything up to get the motor running off of interwebs bits. I put some scotch tape on the motor so you can see it turning more easily.</p>

<iframe class="imgur-embed" width="100%" height="404" frameborder="0" src="http://i.imgur.com/mRuKtxu.gifv#embed"></iframe>

<p>Here’s a cleaned up drawing of the wiring:</p>

<p><img src="http://blog.nyl.io/content/images/2015/07/esp8266_attiny_noftdi_reg_9v_bb.png" alt="" /></p>

<p>In this diagram, the top breadboard power track represents 5V, and the bottom represents 3.3V. The basic logic follows the diagram at the beginning of this blog post. Rather than conceptual arrows, we have wires and breadboards.</p>

<p>Now, if you go to your <code>index.php</code> page, you can click the “Light On” and “Light Off” button. Only now, the light <em>and</em> the motor should turn on.</p>

<p>OOOOO… fancy.</p>

<h2 id="next-steps">Next Steps</h2>

<p>Just when you think you’ve shrunken everything, there’s a way to get things even smaller. For me, the next step is to make a Custom PCB of this and get rid of all the wires and breadboard.</p>

<p>After that, I might even start looking into getting the surface mount version of it working, so it’s even smaller (and cheaper). At this point, the battery and the motor will be the biggest pieces. So if you guys know of smaller 5V battery and motors, <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#032;&#095;&#064;&#110;&#121;&#108;&#046;&#105;&#111;">drop me a line!</a> ✉️</p>

<p>Ok. Now go make stuff.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog//2015/07/esp8266-led-arduino">
        Internet Controlled LED using ESP8266
      </a>
    </h1>

    <span class="post-date">15 Jul 2015</span>

    <p>In my previous post, I covered how to upload sketches using NodeMCU, which is firmware written in Lua. I ran into a few problems:</p>

<ul>
  <li>Uploading big files were prone to error, and it took multiple tries</li>
  <li>Memory! I seemed to not have much</li>
  <li>The callbacks were driving me insane. I decided to not like callback functions for the time being.</li>
</ul>

<p>In comes Arduino to save the day. There are a lot of useful libraries written for Arduino–libraries for stepper motors and parsing JSON for example. Also, the stepper motors are controlled by Arduino’s microcontroller in the end, so it is just simpler to have one language write for both the Wifi Module (ESP) and the microcontroller (Arduino). Last, no upload errors (that weren’t my fault).</p>

<p>The first thing I did was blink an LED, because that’s simply the first thing you do when you get hardware.</p>

<iframe class="imgur-embed" width="100%" height="360" frameborder="0" src="http://i.imgur.com/GfD93zj.gifv#embed"></iframe>

<p>On the client side (the page on my phone), the “Light On” button sends a “On” value to the <code>light.json</code> file. The ESP8266 connects to my home Wifi and reads the <code>light.json</code> file. If it sees an “On” value, it lights up.</p>

<p><img src="/content/images/2015/07/esp_led_dataflow.png" alt="" /></p>

<p>If you want to poke around the code, all the code/schematics I describe in this blog post can be found on this project’s <a href="https://github.com/neuralfirings/esp8266led">GitHub Page</a>.</p>

<h2 id="parts-one-get-yo-stuff">Parts One: Get Yo Stuff</h2>

<p>This project requires the following ingredients:</p>

<ol>
  <li>
    <p><a href="http://amzn.to/1Lu6QHu">ESP8266-01</a>: Module to connect to the Wifis
<a href="http://www.amazon.com/gp/product/B00O34AGSU/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00O34AGSU&amp;linkCode=as2&amp;tag=nylio-20&amp;linkId=QSFWU7POV4SORVP7"><img border="0" src="http://ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=B00O34AGSU&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=US&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=nylio-20" /></a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=nylio-20&amp;l=as2&amp;o=1&amp;a=B00O34AGSU" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>
  </li>
  <li>
    <p><a href="http://www.amazon.com/10PCS-10mm-Ultra-Bright-White/dp/B00BWKMOWY/">White LED</a>: with forward 3.3V (lower level LEDs tend to confuse the ESP, I’m sure you can use resistors and other magical components to fix this but I didn’t look into it much)
<img src="/content/images/2015/07/whiteled.jpg" alt="" /></p>
  </li>
  <li>
    <p><a href="http://www.amazon.com/SparkFun-FTDI-Cable-5V-VCC-3-3V/dp/B00DJBPIGI/">FTDI Cable</a>: You can also use other FTDI tools like FTDI friend
<img src="/content/images/2015/07/ftdiusb.jpg" alt="" /></p>
  </li>
  <li>
    <p><a href="http://www.amazon.com/Teenitor-650mAh-Battery-Charger-Parts/dp/B00NQV0Z46/">Battery</a>: I used a Lipo (Lithium Ion Polymer) battery because it’s small and rechargeable. I actually used <a href="https://www.adafruit.com/product/258">Adafruit’s Battery</a> in the video above, but the one I link to on Amazon should work as well (and it comes with a charger).</p>
  </li>
</ol>

<p><img src="/content/images/2015/07/esp_battery.jpg" alt="" /></p>

<ol>
  <li>You also need essentials like <a href="http://www.amazon.com/Solderless-BreadBoard-tie-points-power-rails/dp/B005GYAIES/">Breadboard</a> and <a href="http://www.amazon.com/2-54mm-Breadboard-Male-male-female-female-female-male/dp/B00E8Z3528/">Jumper Wires</a>.</li>
</ol>

<p>One note. Hehe. I didn’t use regulators for this project. The LiPo Battery I’m using is 3.7V and the ESP8266 take 3.3V, so I guess it’s not THAT bad. But you should use regulators! At least that’s what my friends who electronics tell me. You can find some nice <a href="https://www.adafruit.com/products/2165">3.3V Regulators on Adafruit</a>.</p>

<h2 id="part-two-json--phpn">Part Two: JSON &amp; PHP<sup id="fnref:n"><a href="#fn:n" class="footnote">1</a></sup></h2>

<h3 id="lightjson">light.json</h3>
<p>The <code>light.json</code> file is simple. It either reads <code>{"light":"on"}</code> or <code>{"light":"off"}</code>. That’s it. Keep in mind though, it needs to be set to permission 777 so the PHP file can write to it (though 666 works too).</p>

<h3 id="indexphp">index.php</h3>
<p>The <code>index.php</code> file is the public file that writes <code>{"light":"on"}</code> or <code>{"light":"off"}</code> to <code>light.json</code>. Here is the barebones code. There are two links that links you to the current page with a url parameter <code>?light=on</code> or <code>?light=off</code>. Based on the url parameter, the PHP writes the appropriate instructions to the JSON file.</p>

<p>```
<?php
$light = $_GET['light'];
if($light == "on") {
  $file = fopen("light.json", "w") or die("can't open file");
  fwrite($file, '{"light": "on"}');
  fclose($file);
} 
else if ($light == "off") {
  $file = fopen("light.json", "w") or die("can't open file");
  fwrite($file, '{"light": "off"}');
  fclose($file);
}
?></p>

<p><a href="?light=on">Turn On</a>
<a href="?light=off">Turn Off</a></p>
<div>
  <?php
    if($light=="on") {
      echo("Turn LED on.");
    }
    else if ($light=="off") {
      echo("Turn LED off.");
    }
    else {
      echo ("Do something.");
    }
  ?>
</div>
<p>```</p>

<p>I merged this code into my handy <a href="http://www.nyl.io/template.html">template.html</a> HTML page to start. This page is preloaded with jQuery, Bootstrap (with simple layout preloaded), and Font Awesome. I don’t use jQuery or Font Awesome on this particular project. Then I added some styling classes (e.g. <code>btn-large</code> and styling divs to make things response, pretty, and all that good stuff).</p>

<p>Here’s the final code for <code>index.php</code>:</p>

<p>```
<?php
$light = $_GET['light'];
if($light == "on") {
  $file = fopen("light.json", "w") or die("can't open file");
  fwrite($file, '{"light": "on"}');
  fclose($file);
} 
else if ($light == "off") {
  $file = fopen("light.json", "w") or die("can't open file");
  fwrite($file, '{"light": "off"}');
  fclose($file);
}
?></p>

<html>
  <head>      
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <title>LED for ESP8266</title>
   
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />

  </head>
  <body>
    <div class="row" style="margin-top: 20px;">
      <div class="col-md-8 col-md-offset-2">
        <a href="?light=on" class="btn btn-success btn-block btn-lg">Turn On</a>
        <br />
        <a href="?light=off" class="led btn btn-danger btn-block btn-lg">Turn Off</a>
        <br />
        <div class="light-status well" style="margin-top: 5px; text-align:center">
          <?php
            if($light=="on") {
              echo("Turn LED on.");
            }
            else if ($light=="off") {
              echo("Turn LED off.");
            }
            else {
              echo ("Do something.");
            }
          ?>
        </div>
      </div>
    </div>
  </body>
</html>
<p>```</p>

<h2 id="part-three-hardware-wire-everything-up">Part THREE: Hardware: Wire Everything Up</h2>

<p>Now that code is written, go ahead and wire things up. To do this I used an FTDI to USB cable. The FTDI cable powers the ESP and connects it to the Serial Terminal. Of course, you can also use FTDI Friend or other FTDI connectors. Here is a diagram of the ESP connected to an LED and an FTDI friend from Sparkfun.</p>

<p><img src="/content/images/2015/07/esp8266_led_ftdi_bb.png" alt="" /></p>

<p>Now, when GPIO0 (the purple wire above) is connected to ground at boot, this tells the ESP to start up in bootloader mode. This is when you can flash the ESP, meaning transfer the Arduino code to the ESP. After the Arduino code is loaded, you’ll see a “Done Uploading” status message at the bottom of the ArduinoIDE. Then the code will start running.</p>

<p>If you want to flash another program, then restart the Arduino. You can unplug/replug the USB (which disconnects the Arduino’s power source), or you can reset the Arduino by disconnecting the CH_PD (chip powerdown) pin.</p>

<p>If you don’t want to restart the device in bootloader mode, simply unplug the GPIO0 cable (the purple wire above).</p>

<p>When are you ready to not rely on the USB cable anymore, just unplug everything that connects to the USB. You can also unplug the GPIO to Ground, since you don’t need the bootloader mode anymore. You then connect the VCC (power) and GND (ground) to the red (power) and black (ground) of a battery pack that’s 3.3-5V. Something like this:</p>

<p><img src="/content/images/2015/07/esp8266_led_battery_bb.png" alt="" /></p>

<h2 id="part-four-arduino-code">Part Four: Arduino Code</h2>

<p>I used the ArduinoIDE to connect with the ESP8266 module. This way, you can flash the ESP just like you would flash an Arduino. It makes developing really easy!</p>

<p>Now, this does not mean you need an Arduino in this example. You are just using the software Arduino publishes which allows you to write program and flash them onto tiny little electronic modules like the many different types of Arduino board and now the ESP8266 module.</p>

<h3 id="install-the-esp8266-package-in-arduinoide">1. Install the ESP8266 package in ArduinoIDE</h3>

<p>For this, you need Arduino 1.6.4 or higher. You can download the latest software on <a href="https://www.arduino.cc/en/Main/Software">Arduino’s website</a>. I followed <a href="https://learn.adafruit.com/adafruit-huzzah-esp8266-breakout/using-arduino-ide">Adafruit’s tutorial</a> for setting up the Arduino IDE. They used their Huzzah breakout, where as I am using the lowly ESP8266-01. The software part is the same, the only difference as far as I can tell is which pins to plug into which socket in the FTDI cable.</p>

<p>After everything is updated, open up Preferences (on Mac it’s <code>CMD+,</code> or select from the toolbar Arduino &gt; Preferences). Then enter <code>http://arduino.esp8266.com/package_esp8266com_index.json</code> under “Additional Board Manager’s URL” towards the bottom.</p>

<p>Restart Arduino.</p>

<p>Now, in Arduino, you should file under toolbar Tools &gt; Board &gt; Generic ESP8266 Module.</p>

<p>I also followed Adafruit’s recommendations on a few other settings:</p>

<ul>
  <li>CPU Frequency: 80 MHz</li>
  <li>Flash size: 4M</li>
  <li>Upload speed: 115200</li>
  <li>Port: my USB port (this shows up once you plugged everything in)</li>
  <li>Programmer: AVRISP mkll</li>
</ul>

<h3 id="the-arduino-code">2. The Arduino Code</h3>

<p>Ok, now that ArduinoJson is installed, the we can start doing the fun stuff.  I’m going to start off by showing the compiled code. Then I’ll break it down. If you are the type that like to stare at code and learn that way, then just read the following and you’re done! If not, keep going.</p>

<h4 id="including-arduinojsonh-library">Including ArduinoJson.h Library</h4>

<p>This basically tells the ESP to ping our <code>light.json</code> file. If the latest value for the key <code>light</code> is <code>on</code>, then turn on the LED. Then rinse and repeat every second. Of course, if the value for the key <code>light</code> is <code>off</code>, then turn off the LED.</p>

<p>Now, <code>light.json</code> outputs its value using JSON. So we need a parser. Luckily, a bunch of really smart people have already done this. So no need to reinvent the wheel. I used <a href="https://github.com/bblanchon/ArduinoJson">ArduinoJson</a>. You can find instructions for <a href="https://github.com/bblanchon/ArduinoJson/wiki/Using%20the%20library%20with%20Arduino">installing ArduinoJson library</a> on their wiki.</p>

<p>Then you include this library with <code>#include &lt;ArduinoJson.h&gt;</code> in the file.</p>

<h4 id="the-void-setup-section">The “void setup()” Section</h4>

<p>In this section, you set a few basic configurations set to your specific values:</p>

<ol>
  <li>Your Wifi name and password (the <code>ssid</code> &amp; <code>password</code> variables)</li>
  <li>Your <code>light.json</code> URL (the <code>host</code> &amp; <code>path</code> variable)</li>
  <li>Your output pin (we use GPIO2, so <code>const int pin=2</code>)</li>
</ol>

<p>In <code>void setup()</code>, you set GPIO2 pin to Output (the O part of GPIO) and I like to flash it on High just to show that it’s turning on.</p>

<p>You also begin a Serial connection using <code>Serial.begin(115200)</code>. This enables you to interact with it using the Serial port, which you can open with the little Magnifying glass in the top left corner of the Arduino IDE. You can also connect to the Serial Terminal using <code>screen</code>, CoolTerm, or PuTTY. I covered different options in a previous blog <a href="">post</a>. When you use <code>Serial.print("something")</code> or <code>Serial.println("something")</code>, you should see the results in the Serial Terminal.</p>

<p>Last we start connecting to the internets using <code>Wifi.begin(ssid, password)</code>. While the ESP is still connecting, I have it delay and then print a dot. If you are watching the Serial Terminal, you’ll see dots appear until you log in. It’s just a way to see that the little ESP is trying to connect.</p>

<p>```
#include <esp8266wifi.h>
#include <arduinojson.h></arduinojson.h></esp8266wifi.h></p>

<p>const char* ssid     = “”;<br />
const char* password = “”;</p>

<p>const char* host     = “”; // Your domain<br />
String path          = “/path/to/light.json”;<br />
const int pin        = 2;</p>

<p>void setup() {<br />
  pinMode(pin, OUTPUT); 
  pinMode(pin, HIGH);
  Serial.begin(115200);</p>

<p>delay(10);
  Serial.print(“Connecting to “);
  Serial.println(ssid);</p>

<p>WiFi.begin(ssid, password);
  int wifi_ctr = 0;
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(“.”);
  }</p>

<p>Serial.println(“WiFi connected”);<br />
  Serial.println(“IP address: “ + WiFi.localIP());
}
```</p>

<h4 id="the-void-loop-section">The “void loop()” Section</h4>

<p>Next we start the <code>void loop()</code> function, which Arduino will run and rerun. Here, we will connect to <code>light.json</code> and print the HTTP response (the info you get from the URL).</p>

<p>The stuff used in <code>client.print(...)</code> is called an HTTP request.  This example is contains a very simple request header, you can look through more complex parameters by reading through the XXX.</p>

<p>```
void loop() {<br />
  Serial.print(“connecting to “);
  Serial.println(host);
  WiFiClient client;
  const int httpPort = 80;
  if (!client.connect(host, httpPort)) {
    Serial.println(“connection failed”);
    return;
  }</p>

<p>client.print(String(“GET “) + path + “ HTTP/1.1\r\n” +
               “Host: “ + host + “\r\n” + 
               “Connection: keep-alive\r\n\r\n”);</p>

<p>delay(500); // wait for server to respond</p>

<p>// read response
  int dir = 0; 
  while(client.available()){
    String line = client.readStringUntil(‘\r’);
    Serial.print(line);
    /////////////////////////////////////////////////////////////////////
    // NOTE: we’ll replace the line above with something to parse the 
    // JSON response here!
    /////////////////////////////////////////////////////////////////////
  }
  Serial.print(“closing connection. “);
}
```</p>

<p>Using the two code snippets above, you should see the HTTP response body in the serial, wait a little bit, see it close and re-open the connection, then see the HTTP response body again. Rinse and repeat.</p>

<p>Now that’s all fine and dandy, but we don’t want to see the HTTP response. We want to turn on an LED! So let’s do that now.</p>

<h4 id="parsing-the-json-response">Parsing the JSON Response</h4>

<p>So when you run that, you should get something like this as a response. You can see the log of the response in your Serial Terminal.</p>

<p>```
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: X-Requested-With
Content-Type: application/json
Transfer-Encoding: chunked
Content-Disposition: attachment; 
Date: Sun, 12 Jul 2015 18:49:27 GMT
Cache-control: private</p>

<p>{“light”:”off”}</p>

<p>```</p>

<p>The first section is the HTTP Response header. It tells you what kind of data you’re getting using <code>application/json</code>, that the webpage is up and running using <code>200 OK</code>, and other useful, informative things.</p>

<p>I’m going to ignore these useful, informative things.</p>

<p>The next section after the blank line represents the body of the content. On a web browser, this is the stuff that you see.</p>

<p>Ultimately for the blinky LED, we only care about the last line (<code>{"light":"off"}</code>), which tells the ESP8266 what to do with the LED.</p>

<p>I’m sure there are excellent libraries out there to parse this thing, but I wrote something quick and dirty to apply to values I know will appear in my JSON file. Basically, I will tell the code to ignore everything past the first empty line. Then skip the line after that (the blank line), then read the line after that (the JSON data).</p>

<p>If you have a data response with a different structure, this may not work for you. Ok. You’ve been warned. Now let’s continue.</p>

<p><strong>Warning: crazy-silly-but-it-works hack up ahead</strong>.</p>

<p>What I do is introduce a variable name <code>section</code>. Using this, I keep track of what section of the HTTP response I’m reading.</p>

<p>The program then reads the HTTP response line by line. Each line is represented by the variable <code>line</code> in the while loop. The default value is <code>section = "header"</code> since the HTTP Response begins with header.</p>

<p>It then doesn’t change until it reaches an empty line. When it reach an empty line <code>if (line=="\n")</code> then the program sets <code>section="json"</code> since the next line will be the JSON line we care about.</p>

<p>We parse the JSON line next, and store the JSON into a <code>json_parsed</code> variable. You can read this in the section after the comments <code>// Parse JSON</code>.</p>

<p>After this, we turn the LED on or off depending on the result. We use the <code>strcmp</code> function (short for string comparison). <code>strcmp(json_parsed["light"], "on") == 0)</code>, meaning if the the key <code>light</code> is set to <code>on</code>, then we turn on the LED. We do this using <code>digitalWrite(pin, HIGH)</code> line where the variable <code>pin</code> is the GPIO number we set in the beginning of the file.</p>

<h4 id="final-arduino-code">Final Arduino Code</h4>

<p>```
#include <esp8266wifi.h>
#include <arduinojson.h></arduinojson.h></esp8266wifi.h></p>

<p>const char* ssid     = “”;<br />
const char* password = “”;</p>

<p>const char* host     = “”; // Your domain<br />
String path          = “/path/to/light.json”;<br />
const int pin        = 2;</p>

<p>void setup() {<br />
  pinMode(pin, OUTPUT); 
  pinMode(pin, HIGH);
  Serial.begin(115200);</p>

<p>delay(10);
  Serial.print(“Connecting to “);
  Serial.println(ssid);</p>

<p>WiFi.begin(ssid, password);
  int wifi_ctr = 0;
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(“.”);
  }</p>

<p>Serial.println(“WiFi connected”);<br />
  Serial.println(“IP address: “ + WiFi.localIP());
}</p>

<p>void loop() {<br />
  Serial.print(“connecting to “);
  Serial.println(host);
  WiFiClient client;
  const int httpPort = 80;
  if (!client.connect(host, httpPort)) {
    Serial.println(“connection failed”);
    return;
  }</p>

<p>client.print(String(“GET “) + path + “ HTTP/1.1\r\n” +
               “Host: “ + host + “\r\n” + 
               “Connection: keep-alive\r\n\r\n”);</p>

<p>delay(500); // wait for server to respond</p>

<p>// read response
  String section=”header”;
  while(client.available()){
    String line = client.readStringUntil(‘\r’);
    // Serial.print(line);
    // we’ll parse the HTML body here
    if (section==”header”) { // headers..
      Serial.print(“.”);
      if (line==”\n”) { // skips the empty space at the beginning 
        section=”json”;
      }
    }
    else if (section==”json”) {  // print the good stuff
      section=”ignore”;
      String result = line.substring(1);</p>

<pre><code>  // Parse JSON
  int size = result.length() + 1;
  char json[size];
  result.toCharArray(json, size);
  StaticJsonBuffer&lt;200&gt; jsonBuffer;
  JsonObject&amp; json_parsed = jsonBuffer.parseObject(json);
  if (!json_parsed.success())
  {
    Serial.println("parseObject() failed");
    return;
  }

  // Make the decision to turn off or on the LED
  if (strcmp(json_parsed["light"], "on") == 0) {
    digitalWrite(pin, HIGH); 
    Serial.println("LED ON");
  }
  else {
    digitalWrite(pin, LOW);
    Serial.println("led off");
  }
}   }   Serial.print("closing connection. "); } ```
</code></pre>

<h2 id="part-five-next-steps">Part Five? Next Steps</h2>

<p>The next thing I want to do is connect this whole contraption to a stepper motor. So rather than an LED blinking on and off, the ESP can make a motor turn.</p>

<p>I want to have a bunch of little ESPs around the house connected to different motors that can do different things. I mean, a lot of things require turning action: opening window blinds, turning a key, opening a door. My next step is to get a basic motor example working, then we’ll connect the motors to various household components and start robotifying my apartment.</p>

<div class="footnotes">
  <ol>
    <li id="fn:n">
      <p>Ok, so originally I was using Sparkfun’s Datastream. Until that is, literally minutes before deciding to publish this blogpost, the datastream went down. So I waited. And waited. and Finally decided to screw it and rewrite everything using good ol’ PHP and JSON. <a href="#fnref:n" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog//2015/07/esp8266-meets-nodemcu">
        ESP8266 meets NodeMCU
      </a>
    </h1>

    <span class="post-date">05 Jul 2015</span>

    <p>Yesterday, I made great progress on playing around with the <a href="http://www.ebay.com/itm/151657399118">ESP8266, the $2 Wifi Module</a><sup id="fnref:n"><a href="#fn:n" class="footnote">1</a></sup>. I will continue to document my progress on this blog. First, I just want a place to dump all my notes. That way, if (when) shit start burning, I can at least replicate what I know to work. Second, other people might find it useful and if I can help you avoid some of the headaches I went through, then all the better.</p>

<hr />

<h2 id="the-hardware">The Hardware</h2>
<p>### ESP8266
Ah, the <a href="http://www.ebay.com/itm/151657399118">ESP8266, the $2 Wifi Module</a><sup id="fnref:n:1"><a href="#fn:n" class="footnote">1</a></sup>. For the impatient, it’s also <a href="http://www.amazon.com/dp/B00O34AGSU">available on Amazon Prime for $8</a> with Prime Free Same Day Delivery<sup id="fnref:n:2"><a href="#fn:n" class="footnote">1</a></sup>.</p>

<p>Isn’t it just the most adorable thing? <img src="/content/images/2015/07/IMG_5414.JPG" alt="" /></p>

<h3 id="ftdi-cable">FTDI Cable</h3>
<p>To connect to my laptop, I used Adafruit’s <a href="https://www.adafruit.com/products/70">USB FTDI Cable</a>. <img src="/content/images/2015/07/IMG_5415.JPG" alt="" /></p>

<h3 id="jumper-wires--breadboard">Jumper Wires &amp; Breadboard</h3>
<p>You can use <a href="http://www.amazon.com/Jumper-Wires-Premium-200mm-Female/dp/B008MRZSH8">female-to-male jumper wires</a> and <a href="http://www.amazon.com/dp/B00ARTWJ44">male-to-male jumper wires</a> to connect the pins on the ESP to the FTDI Cable. You might also need a <a href="http://www.amazon.com/gp/product/B005GYAIES/">breadboard</a> since two wires sometime go to one input.</p>

<hr />

<h2 id="the-software-nodemcu">The Software: NodeMCU</h2>
<p><a href="http://nodemcu.com/index_en.html">NodeMCU</a> lets you use LUA scripting language to program the ESP8266. Apparently, there are some issues with memory going this route. I found it to be pretty straightforward.</p>

<p>If you are comfortable with Arduino, there is an Arduino library. I’ll cover how to use ArduinoIDE in a different post.</p>

<p>Here’s what I did to get it working<sup id="fnref:n:3"><a href="#fn:n" class="footnote">1</a></sup>:</p>

<h3 id="hooked-up-esp8266-in-nodemcu-flasher-mode">1. Hooked up ESP8266 in NodeMCU Flasher Mode</h3>
<table style="font-size: 0.8em">
<tr>
<td style="background: #fff"><img src="/content/images/2015/07/esp8266_dia.jpg" style="max-height:120px; margin: 0" /></td>
&lt;td colspan=2 style="background: #fff"&gt;<img src="/content/images/2015/07/ftdi_dia-1.jpg" style="max-height: 120px; margin: 0" />
</tr>
<tr><th>ESP8266</th><th>FTDI</th><th>Why?</th></tr>
<tr><td>VCC</td><td>VCC</td><td>POWER!</td></tr>
<tr><td>GND</td><td>GND</td><td>POWER!</td></tr>
<tr><td>TX</td><td>RX</td><td>Send info from esp to computer</td></tr>
<tr><td>RX</td><td>TX</td><td>Send info from computer to esp</td></tr>
<tr><td>GPIO0</td><td>GND</td><td>Ground to start update</td></tr>
<tr><td>GPIO2</td><td>None</td><td></td></tr>
<tr><td>Reset</td><td>None</td><td></td></tr>
<tr><td>CH_PD</td><td>VCC</td><td>Enables the chip</td></tr>
</table>

<h3 id="flash-nodemcu-firmware">2. Flash NodeMCU Firmware</h3>
<p>Mac/Linux Command Line can use Esptool (see below). Windows machines can use <a href="https://github.com/nodemcu/nodemcu-flasher">NodeMCU-Flasher</a>.</p>

<h4 id="get-port-name">Get Port Name</h4>
<p>I ran this command to get the port name for my USB. The USB has to be plugged in and hooked up for this to show.</p>

<p><code>
ls /dev/tty.*
</code></p>

<p>On a Mac, you should get something like <code>/dev/tty.usbserial-ABC</code>.</p>

<p>For Windows, you can use your Device Manager and look under “Ports (COM and LPT)”. The Port Name should be <code>COM3</code> or something like that. You might have to install FTDI Driver first.</p>

<h4 id="esptool">esptool</h4>

<p><a href="https://github.com/themadinventor/esptool">Esptool</a> is a Python script that lets you flash the ESP8266 module.</p>

<p>Download latest <a href="https://github.com/nodemcu/nodemcu-firmware/tree/master/pre_build/latest">NodeMCU Firmware</a> (a file name “nodemcu_latest.bin”) into some folder. Then, install Esptool, I used git clone to do this. You can also just download the python file, <a href="https://github.com/themadinventor/esptool/raw/master/esptool.py">esptool.py</a>.</p>

<p><code>
git clone https://github.com/themadinventor/esptool.git
cd esptool
python esptool.py --port &lt;YOUR_PORT_NAME&gt; write_flash 0x00000 &lt;PATH_TO_FIRMWARE&gt;
</code></p>

<p>For example, say your port name is <code>/dev/tty.usbserial-ABC</code> and you downloaded the <code>nodemcu_latest.bin</code> to <code>/Users/me/nodemcu/nodemcu_latest.bin</code>, you’d write:</p>

<p><code>
python esptool.py --port /dev/tty.usbserial-ABC write_flash 0x00000 /Users/me/nodemcu/nodemcu_latest.bin
</code></p>

<h3 id="hooked-up-esp8266-in-nodemcu-coding-mode">3. Hooked up ESP8266 in NodeMCU Coding Mode</h3>
<p>The coding mode is similar to Flash Mode, but without GPIO0 connected to ground.</p>
<table style="font-size: 0.8em">
<tr>
<td style="background: #fff"><img src="/content/images/2015/07/esp8266_dia.jpg" style="max-height:120px; margin: 0" /></td>
&lt;td colspan=2 style="background: #fff"&gt;<img src="/content/images/2015/07/ftdi_dia-1.jpg" style="max-height: 120px; margin: 0" />
</tr>
<tr><th>ESP8266</th><th>FTDI</th><th>Why?</th></tr>
<tr><td>VCC</td><td>VCC</td><td>POWER!</td></tr>
<tr><td>GND</td><td>GND</td><td>POWER!</td></tr>
<tr><td>TX</td><td>RX</td><td>Send info from esp to computer</td></tr>
<tr><td>RX</td><td>TX</td><td>Send info from computer to esp</td></tr>
<tr><td>GPIO0</td><td>None</td><td></td></tr>
<tr><td>GPIO2</td><td>None</td><td></td></tr>
<tr><td>Reset</td><td>None</td><td></td></tr>
<tr><td>CH_PD</td><td>VCC</td><td>Enables the chip</td></tr>
</table>

<h3 id="connect-via-serial-terminal">4. Connect via Serial Terminal</h3>

<p>For Mac/Linux, use the screen command line tool. Mac Users can also use <a href="http://freeware.the-meiers.org/">CoolTerm</a>. Windows users can use <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY</a>. Other options are covered in <a href="https://learn.sparkfun.com/tutorials/terminal-basics/all">Sparkfun’s Terminal Basics Guide</a>. This guide starts with detailed explanation and what this “terminal” thing is and a little history as well. A good read for the curious.</p>

<p>For NodeMCU, use <code>baud rate=9600</code>. I’m not sure if you have to, but all the tutorials I’ve read online says to use 9600. So sure, why not. 9600.</p>

<h4 id="screen-command">Screen Command</h4>

<p><a href="https://kb.iu.edu/d/acuy">Screen</a> allows you to use multiple windows (virtual VT100 terminals) in Mac and Linux machines. You can call it using the command line:</p>

<p><code>
screen &lt;PORT_NAME&gt; &lt;BAUD_RATE&gt;
</code>
Say, you get <code>/dev/tty.usbserial-ABC</code> as your USB port name and want to connect using <code>9600</code> baud rate. You would type in:
<code>
screen /dev/tty.usbserial-ABC 9600
</code>
To exit screen, <code>CTRL+A</code> theb <code>CTRL+\</code>one after the other.</p>

<h4 id="coolterm">CoolTerm</h4>
<p>You can also use <a href="http://freeware.the-meiers.org/">CoolTerm</a> if you want a GUI tool. Open up CoolTerm, then click Options. Set the Baud Rate to 9600 and select the Port. You might have to click “Re-scan Serial Ports.”</p>

<p>Then under “Terminal” (option on the left side), check “Handle BS and DEL Character.” This will enable you to use the backspace or delete key<sup id="fnref:n:4"><a href="#fn:n" class="footnote">1</a></sup>.</p>

<p>Then click “OK” and click “Connect.”</p>

<h3 id="start-coding">5. Start Coding!</h3>

<p>You can try a simple hello world to see if it works.</p>

<p><code>
print("hello world")
</code></p>

<p>This should return… well, hello world.</p>

<p>Try fiddling around with some of the <a href="http://nodemcu.com/index_en.html#fr_5475f7667976d8501100000f">NodeMCU Examples</a>. A complete list of functions you can call is <a href="https://github.com/nodemcu/nodemcu-firmware/wiki/nodemcu_api_en">documented here</a>.</p>

<h4 id="initlua">init.lua</h4>
<p><code>init.lua</code> is the file your ESP8266 will run at boot. Just.. don’t put an infinite loop into this file like I did the first time. If you do, you’ll have to reflash your module.</p>

<p>Now, using a Serial Terminal you can type (or copy/paste) one line at a time. This might make your head explode. In comes luatool to save the day.</p>

<h4 id="luatool">luatool</h4>
<p><a href="https://github.com/4refr0nt/luatool">Luatool</a> is a Python script that enables you to edit Lua using whatever text editor you wish, and then send the file to the ESP8266 module.</p>

<p>I used Git Clone to install. But you can download the <a href="https://github.com/4refr0nt/luatool/raw/master/luatool/luatool.py">luatool.py file</a> instead.</p>

<p><code>
git clone https://github.com/4refr0nt/luatool.git
cd luatool/luatool
</code>
Then you can upload a lua file in the currently directory using: 
<code>bash
python luatool.py --port &lt;YOUR_PORT_NAME&gt; --src &lt;YOUR_FILE.lua&gt;
</code>
For example, if you get <code>/dev/tty.usbserial-ABC</code> as your USB port name and want to upload <code>foo.lua</code>. You would type in:
<code>
python luatool.py --port /dev/tty.usbserial-ABC --src foo.lua
</code></p>

<p>NOTE: you need to disconnect from all other connections to the ESP8266. So if you’re using CoolTerm, click “Disconnect” at the top. If you’re using <code>screen</code>, do <code>Ctrl+a</code> then <code>Ctrl+\</code> to disconnect.</p>

<h2 id="next-steps">Next Steps</h2>

<p>I’ve found this to be pretty nifty. Looking through the NodeMCU example, you can set up a simple web server, though the memory limits of Lua leaves much to be desired.</p>

<p>Also, we tried on our local network and logging in takes a while. I’m not quite sure how networks work, but I’m sure that I experienced slowness. And I’m sure that I don’t like slowness.</p>

<h3 id="better-way-to-parse-http-responses">1. Better way to parse HTTP Responses</h3>

<p>The ESP8266 can also act as a client. It can read webpages and execute certain commands. I will need to write something to parse all the header junk out and return a JSON or something simple. Right now when I send a request, I get this monster:</p>

<p>```
HTTP/1.1 200 OK
Server: nginx
Date: Sun, 05 Jul 2015 01:56:57 GMT
Content-Type: application/json; charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
Status: 200 OK
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
X-UA-Compatible: chrome=1
ETag: “9bb58f26192e4ba00f01e2e7b136bbd8”
Cache-Control: max-age=0, private, must-revalidate
X-Request-Id: 8f9baf99-1418-4558-90ff-de1e2b55988a
X-Runtime: 0.016318
Vary: Origin</p>

<p>d
{“foo”:”bar”}
0
```</p>

<p>All I really want is <code>{"foo": "bar"}</code> here.</p>

<h3 id="better-way-to-load-up-large-lua-scripts">2. Better way to load up “large” lua scripts</h3>

<p>I also need a way to write larger Lua scripts. <code>luatool</code> is ~~a bit~~ a lot shaky with larger files (&gt;40 lines). Maybe I’ll write a function that appends to a file rather than write a new file.</p>

<p>Then again, maybe this is why people use ArduinoIDE to program the ESP8266 rather than NodeMCU. More on that later.</p>

<p>🍻 Oh well, time to drink beer. Happy 4th of July, everyone! 🇺🇸</p>

<!-- FOOTNOTES -->

<div class="footnotes">
  <ol>
    <li id="fn:n">
      <p>And boy, do I make a lot of typos! You don’t realize how bad your typing accuracy is until they take away the backspace option. <a href="#fnref:n" class="reversefootnote">&#8617;</a> <a href="#fnref:n:1" class="reversefootnote">&#8617;<sup>2</sup></a> <a href="#fnref:n:2" class="reversefootnote">&#8617;<sup>3</sup></a> <a href="#fnref:n:3" class="reversefootnote">&#8617;<sup>4</sup></a> <a href="#fnref:n:4" class="reversefootnote">&#8617;<sup>5</sup></a></p>
    </li>
  </ol>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog//2015/07/esp8266-hello-world">
        Hello (ESP8266) World
      </a>
    </h1>

    <span class="post-date">03 Jul 2015</span>

    <p>Yesterday, I sat down and played with my shiny new ESP8266 module. I also got the <a href="http://adafruit.com/products/2471">Huzzah Breakout Board</a> from Adafruit, which uses an ESP module. Actually, I’m still trying to figure out just what is the difference between ESP8266, Huzzah, and NodeMCU.</p>

<p>So far, I’ve accomplished the following:</p>

<ul>
  <li>Gotten an LED to blink on the Huzzah</li>
  <li>Gotten the Huzzah to read not one, but TWO webpages</li>
</ul>

<iframe class="imgur-embed" width="100%" height="404" frameborder="0" src="http://i.imgur.com/RPGykw3.gifv#embed"></iframe>

<h3 id="the-hardware-wirings">The hardware wirings</h3>
<p><img src="/content/images/2015/07/huzzahblink.jpg" alt="" /></p>

<p>I’ll post more interesting projects later when I have more time to fiddle.</p>

<h3 id="the-code">The code</h3>

<p>I use <a href="http://freeware.the-meiers.org/">CoolTerm</a> for Mac and followed <a href="https://learn.adafruit.com/adafruit-huzzah-esp8266-breakout">Adafruit’s tutorial</a>.</p>

<ol>
  <li>Click Options</li>
  <li>Plug in USB</li>
  <li>Click “Re-Scan Serial Ports”</li>
  <li>Set Port dropdown to “usbserial-blahblah”</li>
  <li>Set Baudrate to 9600</li>
  <li>Click Terminal (left side)</li>
  <li>Check the “Handle BS and Del Character,” without which I can’t use backspace<sup id="fnref:n"><a href="#fn:n" class="footnote">1</a></sup>.</li>
  <li>Click OK</li>
  <li>Click Connect</li>
  <li>Type in the following code line by line</li>
</ol>

<p><code>
gpio.mode(5, gpio.OUTPUT)
while 1 do
  gpio.write(5, gpio.HIGH)
  tmr.delay(1000000)   -- wait 1,000,000 us = 1 second
  gpio.write(5, gpio.LOW)
  tmr.delay(1000000)   -- wait 1,000,000 us = 1 second
end
</code></p>

<p>As for the ESP8266? Well, I got the ESP8266 plugged into my laptop… that’s it.</p>

<p>Yeah, still need work here. I would like to just use the ESP because I can get these for $2 on Ebay. I mean, the Huzzah breakout isn’t going to break the bank. It’s only $10 on Adafruit. But still, that’s a 20% decrease in my BOM<sup id="fnref:n:1"><a href="#fn:n" class="footnote">1</a></sup>!</p>

<p>I think I will continue to fiddle around with Adafruit’s Huzzah Breakout. It would be nice to figure out how to hook the ESP8266 module directly to an Arduino or something, but I’m not sure what’s the deal with that right now.</p>

<div class="footnotes">
  <ol>
    <li id="fn:n">
      <p>bill of materials = BOM <a href="#fnref:n" class="reversefootnote">&#8617;</a> <a href="#fnref:n:1" class="reversefootnote">&#8617;<sup>2</sup></a></p>
    </li>
  </ol>
</div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog//2015/06/lean-manufacturing-v2">
        Lean Manufacturing, v2
      </a>
    </h1>

    <span class="post-date">30 Jun 2015</span>

    <p>The concept of “Lean Startup” is pretty pervasive in tech. This idea comes from <a href="https://en.wikipedia.org/wiki/Lean_manufacturing">Lean Manufacturing</a>, which argues the benefits of small batch production. Smaller batches enables manufacturers to eliminate bottlenecks in production, reduce waste, and continuously improve. Eric Ries applied this concept to software and coined the term “Lean Startup.” Release small updates, and release often. With each release, test hypotheses, learn, and iterate.</p>

<p>The search term “Lean Startup” now returns 4.7 Million hits on Google. The book has 800+ reviews on Amazon. 67,000+ students signed up for the <a href="https://www.udemy.com/lean-startup-sxsw-2012-videos-and-presentations/">Lean Startup Udemy Course</a>. I think people like this thing.</p>

<p><strong>But wait… what about manufacturing?</strong></p>

<p>Manufacturing isn’t very lean when matched against the software industry. Bits and bytes are cheap. Atoms are expensive.</p>

<p>This is changing.</p>

<h2 id="the-rise-of-small-batch-manufacturing">The Rise of Small Batch Manufacturing</h2>

<p>The internet has made it easy to buy and acquire cheap electronic parts, prototyping boards, and raw materials. We now have access to prototyping and fabrication services like <a href="http://shapeways.com">Shapeways</a> for 3D Printing, <a href="http://ponoko.com">Ponoko</a> for Laser Cutting, <a href="http://oshpark.com">OSHPark</a> for PCB. All of these services have a minimum order quantity of one<sup id="fnref:n"><a href="#fn:n" class="footnote">1</a></sup>.</p>

<!--
You have tools like [TinkerCAD](http://tinkercad.com), [OnShape](http://onshape.com), and [Blender](http://blender.org) for free modeling tools. You have [Fritzing](http://fritzing.org) and [KiCAD](http://kicad-pcb.org) for for free electronic design software. [Arduinos](http://www.arduino.cc) and [Raspberry Pi](https://www.raspberrypi.org/) makes it easier to put together prototypes. 

Sites like [Instructables](http://instructables.com), [Adafruit](http://learn.adafruit.com), and [Hackaday](http://hackaday.com) feed the hungry inventors-to-be loads of free educational materials. Loads! -->

<p>We are witnessing the growth of an ecosystem that supports smaller and smaller batch manufacturing.</p>

<p>So what does this “small batch” business enable?</p>

<h2 id="innovation">1. Innovation</h2>

<p>You have 10 users buy your first batch. You learn something from 10 users. You use that knowledge to make the next batch better. PROFIT!</p>

<p>Scratch that. In the earliest stage of product development, it doesn’t even take 10 users. It only takes one. You.</p>

<p>These can be simple things from where to put the power cord adapter to more complex design issues like the wireless receiver doesn’t work when lefties use your device (ahem, I’m looking at you Apple).</p>

<h2 id="commitment">2. Commitment</h2>

<p>Small batches make production easier to commit to. One thing I don’t see enough of (or come to think of it, I don’t see ever) is the Kickstarter limit. Whenever Kickstarter projects run late, one of the root causes seem to be they were way more successful than anybody anticipated. The factories they lined up for production were more suitable for small batches. Their super awesome multi-million Kickstarter then threw the whole production plan out of whack. Annoying humble braggedness aside, it becomes a thorny problem for the backers of such projects.</p>

<p>Here’s something crazy: <strong>more isn’t always better</strong>. I wonder if they just cap how much funding they can get (or how much funding comes with a promise of a product), whether they will end up with a better product, happier customers, and more fans. In the long term, it might even help their business and product if they just say “NO” to more money upfront.</p>

<h2 id="community">3. Community</h2>

<p>Speaking of fans, there’s a new currency in the world, one based on social interactions. Community literally has value. <a href="http://usv.com">Union Square Ventures</a> based their own investment theses around community. Why? Because community is hard for competitors to rebuild.</p>

<p>Smaller batches enable improvements more often. This drives the community to participate. If I see my feature requests implemented, my itches scratched, I am incentivized to offer more feedback in the future. Community is important. The question of which 3D printer I recommend often boils down to which has the more active community.</p>

<p>There’s a difference between community and customers. Customers buy, community does so much more. Community will also help improve your product. Some provide feedback; others contribute code (if we’re talking about open sourced products). Often, the community takes the place of a customer support team. People help one another with their products.</p>

<hr />

<p>Software took the concept of “lean manufacturing” from the manufacturing industry. And now, manufacturing is catching up to its own reputation.</p>

<p>Hardware speed and software speed are still orders of orders of magnitudes apart. I suspect that this gap will shrink more quickly than we can grasp.</p>

<p>I can’t wait to see how Lean Manufacturing will change how things are made.</p>

<hr />

<!--
Notes
- Small batch
- Iteration (Lean Manufacturing to Lean Startup to Lean Manufacturing)
- Inventor = Entrepreneur = Designer
- Open source, accessible
- Software + Hardware = New XWare
-->
<div class="footnotes">
  <ol>
    <li id="fn:n">
      <p>Well, technically OSHPark has 3 QTY, but it’s still very cheap at 3. <a href="#fnref:n" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/blog/page4">Older</a>
  
  
    
      <a class="pagination-item newer" href="/blog/page2">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
